<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="" xml:lang="">
<head>

  <meta charset="utf-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <title>Chapter 3 Merging, re-shaping, and regular expressions | Follow-up on R</title>
  <meta name="description" content="Chapter 3 Merging, re-shaping, and regular expressions | Follow-up on R" />
  <meta name="generator" content="bookdown 0.13 and GitBook 2.6.7" />

  <meta property="og:title" content="Chapter 3 Merging, re-shaping, and regular expressions | Follow-up on R" />
  <meta property="og:type" content="book" />
  
  
  
  

  <meta name="twitter:card" content="summary" />
  <meta name="twitter:title" content="Chapter 3 Merging, re-shaping, and regular expressions | Follow-up on R" />
  
  
  




  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <meta name="apple-mobile-web-app-capable" content="yes" />
  <meta name="apple-mobile-web-app-status-bar-style" content="black" />
  
  
<link rel="prev" href="seminar2.html"/>

<script src="libs/jquery-2.2.3/jquery.min.js"></script>
<link href="libs/gitbook-2.6.7/css/style.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-table.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-bookdown.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-highlight.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-search.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-fontsettings.css" rel="stylesheet" />







<script src="lib/bootstrap/3.3.7/js/bootstrap.min.js"></script>
<script src="js/codefolding.js"></script>


<script>
$(document).ready(function () {
  window.initializeCodeFolding();
});
</script>


<style type="text/css">
a.sourceLine { display: inline-block; line-height: 1.25; }
a.sourceLine { pointer-events: none; color: inherit; text-decoration: inherit; }
a.sourceLine:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode { white-space: pre; position: relative; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
code.sourceCode { white-space: pre-wrap; }
a.sourceLine { text-indent: -1em; padding-left: 1em; }
}
pre.numberSource a.sourceLine
  { position: relative; left: -4em; }
pre.numberSource a.sourceLine::before
  { content: attr(title);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; pointer-events: all; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {  }
@media screen {
a.sourceLine::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } /* Alert */
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #7d9029; } /* Attribute */
code span.bn { color: #40a070; } /* BaseN */
code span.bu { } /* BuiltIn */
code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4070a0; } /* Char */
code span.cn { color: #880000; } /* Constant */
code span.co { color: #60a0b0; font-style: italic; } /* Comment */
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #ba2121; font-style: italic; } /* Documentation */
code span.dt { color: #902000; } /* DataType */
code span.dv { color: #40a070; } /* DecVal */
code span.er { color: #ff0000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #40a070; } /* Float */
code span.fu { color: #06287e; } /* Function */
code span.im { } /* Import */
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #007020; font-weight: bold; } /* Keyword */
code span.op { color: #666666; } /* Operator */
code span.ot { color: #007020; } /* Other */
code span.pp { color: #bc7a00; } /* Preprocessor */
code span.sc { color: #4070a0; } /* SpecialChar */
code span.ss { color: #bb6688; } /* SpecialString */
code span.st { color: #4070a0; } /* String */
code span.va { color: #19177c; } /* Variable */
code span.vs { color: #4070a0; } /* VerbatimString */
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
</style>

<link rel="stylesheet" href="lib\bootstrap\3.3.7\css\bootstrap.min.css" type="text/css" />
<link rel="stylesheet" href="css\readthedocs.css" type="text/css" />
<link rel="stylesheet" href="css\custom.css" type="text/css" />
</head>

<body>



  <div class="book without-animation with-summary font-size-2 font-family-1" data-basepath=".">

    <div class="book-summary">
      <nav role="navigation">

<ul class="summary">
<li class="chapter" data-level="" data-path="index.html"><a href="index.html"><i class="fa fa-check"></i>About this course</a></li>
<li class="chapter" data-level="1" data-path="seminar1.html"><a href="seminar1.html"><i class="fa fa-check"></i><b>1</b> Data sub-setting and logical conditions</a><ul>
<li class="chapter" data-level="1.1" data-path="seminar1.html"><a href="seminar1.html#learning-objectives"><i class="fa fa-check"></i><b>1.1</b> Learning objectives</a><ul>
<li class="chapter" data-level="1.1.1" data-path="seminar1.html"><a href="seminar1.html#sub-setting"><i class="fa fa-check"></i><b>1.1.1</b> Sub-setting</a></li>
<li class="chapter" data-level="1.1.2" data-path="seminar1.html"><a href="seminar1.html#logical-conditions"><i class="fa fa-check"></i><b>1.1.2</b> Logical conditions</a></li>
<li class="chapter" data-level="1.1.3" data-path="seminar1.html"><a href="seminar1.html#re-naming-variables"><i class="fa fa-check"></i><b>1.1.3</b> Re-naming variables</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="2" data-path="seminar2.html"><a href="seminar2.html"><i class="fa fa-check"></i><b>2</b> Tidyverse introduction</a><ul>
<li class="chapter" data-level="2.1" data-path="seminar2.html"><a href="seminar2.html#seminar"><i class="fa fa-check"></i><b>2.1</b> Seminar</a><ul>
<li class="chapter" data-level="2.1.1" data-path="seminar2.html"><a href="seminar2.html#introduction-to-the-tidyverse"><i class="fa fa-check"></i><b>2.1.1</b> Introduction to the tidyverse</a></li>
<li class="chapter" data-level="2.1.2" data-path="seminar2.html"><a href="seminar2.html#data-visualization-with-ggplot2"><i class="fa fa-check"></i><b>2.1.2</b> Data visualization with ggplot2</a></li>
<li class="chapter" data-level="2.1.3" data-path="seminar2.html"><a href="seminar2.html#renaming-variables-and-selecting-subsets"><i class="fa fa-check"></i><b>2.1.3</b> Renaming variables and selecting subsets</a></li>
<li class="chapter" data-level="2.1.4" data-path="seminar2.html"><a href="seminar2.html#aggregating-and-pipes"><i class="fa fa-check"></i><b>2.1.4</b> Aggregating and pipes</a></li>
<li class="chapter" data-level="2.1.5" data-path="seminar2.html"><a href="seminar2.html#merging-data-sets"><i class="fa fa-check"></i><b>2.1.5</b> Merging data sets</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="3" data-path="seminar3.html"><a href="seminar3.html"><i class="fa fa-check"></i><b>3</b> Merging, re-shaping, and regular expressions</a><ul>
<li class="chapter" data-level="3.1" data-path="seminar3.html"><a href="seminar3.html#seminar-1"><i class="fa fa-check"></i><b>3.1</b> Seminar</a><ul>
<li class="chapter" data-level="3.1.1" data-path="seminar3.html"><a href="seminar3.html#merging"><i class="fa fa-check"></i><b>3.1.1</b> Merging</a></li>
<li class="chapter" data-level="3.1.2" data-path="seminar3.html"><a href="seminar3.html#re-shaping"><i class="fa fa-check"></i><b>3.1.2</b> Re-shaping</a></li>
<li class="chapter" data-level="3.1.3" data-path="seminar3.html"><a href="seminar3.html#regular-expression"><i class="fa fa-check"></i><b>3.1.3</b> Regular expression</a></li>
</ul></li>
</ul></li>
</ul>

      </nav>
    </div>

    <div class="book-body">
      <div class="body-inner">
        <div class="book-header" role="navigation">
          <h1>
            <i class="fa fa-circle-o-notch fa-spin"></i><a href="./">Follow-up on R</a>
          </h1>
        </div>

        <div class="page-wrapper" tabindex="-1" role="main">
          <div class="page-inner">

            <section class="normal" id="section-">
<div id="merging-re-shaping-and-regular-expressions" class="section level1">
<h1><span class="header-section-number">Chapter 3</span> Merging, re-shaping, and regular expressions</h1>
<div id="seminar-1" class="section level2">
<h2><span class="header-section-number">3.1</span> Seminar</h2>
<p>In this part of the course, we will merge data sets again. The difference to the previous exercise is that both data sets contain the same observations but different variables (columns) which is the more common case. We explain how re-shaping data works with a small “toy” example which should make the procedure more clear. Re-shaping is very often necessary for producing ggplot graphs. Finally, we will introduce a simple regular expression example. Regular expressions are extremely useful to identifying similar content that is not exactly identical.</p>
<div id="merging" class="section level3">
<h3><span class="header-section-number">3.1.1</span> Merging</h3>
<p>We start by loading the <code>eu</code> data set again.</p>
<div class="container btn-container">
<p><button type = "button" class = "btn btn-lg btn-success" onclick="window.open('qog_eureg_long_sep16.csv');">Download Data</button>
<button type = "button" class = "btn btn-lg btn-success" onclick="window.open('https://www.qogdata.pol.gu.se/data/qog_eureg_sep16.pdf');">Codebook</button></p>
</div>
<div class="sourceCode" id="cb117"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb117-1" title="1">eu &lt;-<span class="st"> </span><span class="kw">read.csv</span>(<span class="st">&quot;qog_eureg_long_sep16.csv&quot;</span>, <span class="dt">stringsAsFactors =</span> <span class="ot">FALSE</span>)</a></code></pre></div>
<p>We now create a subset of the data set that only includes the variables <em>year</em>, <em>country</em>, <em>region</em>, <em>wealth</em>, <em>quality.of.government</em>. We also filter by France, Germany, and the UK, and the years 2000 – 2013. Furthermore, we must also filter out the observations within a country that are the country itself. Then, we save the data set as <code>eu_subset1.csv</code>.</p>
<div class="sourceCode" id="cb118"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb118-1" title="1"><span class="kw">library</span>(tidyverse)</a>
<a class="sourceLine" id="cb118-2" title="2"></a>
<a class="sourceLine" id="cb118-3" title="3"><span class="co"># copy, rename, select, filter, save</span></a>
<a class="sourceLine" id="cb118-4" title="4">eu_subset12 &lt;-<span class="st"> </span>eu <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb118-5" title="5"><span class="st">  </span>dplyr<span class="op">::</span><span class="kw">select</span>(year,</a>
<a class="sourceLine" id="cb118-6" title="6">         <span class="dt">country =</span> NUTS0,</a>
<a class="sourceLine" id="cb118-7" title="7">         <span class="dt">region =</span> region_name,</a>
<a class="sourceLine" id="cb118-8" title="8">         <span class="dt">wealth =</span> econ_2gdp_eur_hab,</a>
<a class="sourceLine" id="cb118-9" title="9">         <span class="dt">quality.of.government =</span> eqi_eqi) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb118-10" title="10"><span class="st">  </span><span class="kw">filter</span>(country <span class="op">%in%</span><span class="st"> </span><span class="kw">c</span>(<span class="st">&quot;FR&quot;</span>, <span class="st">&quot;DE&quot;</span>, <span class="st">&quot;UK&quot;</span>) <span class="op">&amp;</span><span class="st"> </span>year <span class="op">&gt;</span><span class="st"> </span><span class="dv">1999</span> <span class="op">&amp;</span><span class="st"> </span>year <span class="op">&lt;</span><span class="st"> </span><span class="dv">2014</span> <span class="op">&amp;</span><span class="st"> </span></a>
<a class="sourceLine" id="cb118-11" title="11"><span class="st">           </span><span class="op">!</span>(region <span class="op">%in%</span><span class="st"> </span><span class="kw">c</span>(<span class="st">&quot;DEUTSCHLAND &quot;</span>, <span class="st">&quot;FRANCE&quot;</span>, <span class="st">&quot;UNITED KINGDOM&quot;</span>))) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb118-12" title="12"><span class="st">  </span><span class="kw">write.table</span>(<span class="dt">file =</span> <span class="st">&quot;eu_subset1.csv&quot;</span>, <span class="dt">sep =</span> <span class="st">&quot;,&quot;</span>,</a>
<a class="sourceLine" id="cb118-13" title="13">              <span class="dt">row.names =</span> <span class="ot">FALSE</span>, <span class="dt">col.names =</span> <span class="ot">TRUE</span>) </a></code></pre></div>
<p>Let us create another subset of the original data set. It will include the same countries plus the Netherlands and Belgium but on the aggregate level, i.e. it is not the regional level. Furthermore, there will be an additional variable which is the total population size but it will exclude wealth and the quality of government.</p>
<div class="sourceCode" id="cb119"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb119-1" title="1">eu_subset2 &lt;-<span class="st"> </span>eu <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb119-2" title="2"><span class="st">    </span>dplyr<span class="op">::</span><span class="kw">select</span>(</a>
<a class="sourceLine" id="cb119-3" title="3">      year,</a>
<a class="sourceLine" id="cb119-4" title="4">      <span class="dt">country =</span> NUTS0,</a>
<a class="sourceLine" id="cb119-5" title="5">      <span class="dt">population =</span> demo_d2jan_t) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb119-6" title="6"><span class="st">  </span><span class="kw">filter</span>(country <span class="op">%in%</span><span class="st"> </span><span class="kw">c</span>(<span class="st">&quot;FR&quot;</span>, <span class="st">&quot;DE&quot;</span>, <span class="st">&quot;UK&quot;</span>) <span class="op">&amp;</span><span class="st"> </span>year <span class="op">&gt;</span><span class="st"> </span><span class="dv">1999</span> <span class="op">&amp;</span><span class="st"> </span>year <span class="op">&lt;</span><span class="st"> </span><span class="dv">2014</span>) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb119-7" title="7"><span class="st">  </span><span class="kw">group_by</span>(country, year) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb119-8" title="8"><span class="st">  </span><span class="kw">summarize</span>(<span class="dt">population =</span> <span class="kw">sum</span>(population, <span class="dt">na.rm =</span> <span class="ot">TRUE</span>)) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb119-9" title="9"><span class="st">  </span><span class="kw">write.table</span>(<span class="dt">file =</span> <span class="st">&quot;eu_subset2.csv&quot;</span>, <span class="dt">sep =</span> <span class="st">&quot;,&quot;</span>,</a>
<a class="sourceLine" id="cb119-10" title="10">              <span class="dt">row.names =</span> <span class="ot">FALSE</span>, <span class="dt">col.names =</span> <span class="ot">TRUE</span>)</a></code></pre></div>
<p>Note that we needed to use the <code>sum()</code> function in summarize rather than <code>mean()</code> when we wanted average wealth or average quality of government. The <em>population</em> variable is the sum of the regional populations in a given year and country. To demonstrate merging, we now clear our workspace.</p>
<div class="sourceCode" id="cb120"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb120-1" title="1"><span class="kw">rm</span>(<span class="dt">list=</span><span class="kw">ls</span>())</a></code></pre></div>
<p>We load the two data sets we created and inspect them. We do this to understand what will happen in merging.</p>
<div class="sourceCode" id="cb121"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb121-1" title="1">eu1 &lt;-<span class="st"> </span><span class="kw">read.csv</span>(<span class="dt">file =</span> <span class="st">&quot;eu_subset1.csv&quot;</span>, <span class="dt">sep =</span> <span class="st">&quot;,&quot;</span>, <span class="dt">stringsAsFactors =</span> <span class="ot">FALSE</span>)</a>
<a class="sourceLine" id="cb121-2" title="2">eu2 &lt;-<span class="st"> </span><span class="kw">read.csv</span>(<span class="dt">file =</span> <span class="st">&quot;eu_subset2.csv&quot;</span>, <span class="dt">sep =</span> <span class="st">&quot;,&quot;</span>, <span class="dt">stringsAsFactors =</span> <span class="ot">FALSE</span>)</a></code></pre></div>
<p>We start by printing the first 30 observations of the <code>eu1</code> data set.</p>
<div class="sourceCode" id="cb122"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb122-1" title="1"><span class="kw">head</span>(eu1, <span class="dt">n =</span> <span class="dv">30</span>)</a></code></pre></div>
<pre><code>   year country             region wealth quality.of.government
1  2000      DE BADEN-WÃœRTTEMBERG  29700                    NA
2  2001      DE BADEN-WÃœRTTEMBERG  30900                    NA
3  2002      DE BADEN-WÃœRTTEMBERG  31000                    NA
4  2003      DE BADEN-WÃœRTTEMBERG  31100                    NA
5  2004      DE BADEN-WÃœRTTEMBERG  31400                    NA
6  2005      DE BADEN-WÃœRTTEMBERG  31700                    NA
7  2006      DE BADEN-WÃœRTTEMBERG  33700                    NA
8  2007      DE BADEN-WÃœRTTEMBERG  35600                    NA
9  2008      DE BADEN-WÃœRTTEMBERG  36000                    NA
10 2009      DE BADEN-WÃœRTTEMBERG  33600                    NA
11 2010      DE BADEN-WÃœRTTEMBERG  36400              1.010530
12 2011      DE BADEN-WÃœRTTEMBERG  38700                    NA
13 2012      DE BADEN-WÃœRTTEMBERG  39200                    NA
14 2013      DE BADEN-WÃœRTTEMBERG  39900              0.980281
15 2000      DE          Stuttgart  33300                    NA
16 2001      DE          Stuttgart  35000                    NA
17 2002      DE          Stuttgart  34800                    NA
18 2003      DE          Stuttgart  35200                    NA
19 2004      DE          Stuttgart  35200                    NA
20 2005      DE          Stuttgart  35100                    NA
21 2006      DE          Stuttgart  37700                    NA
22 2007      DE          Stuttgart  40200                    NA
23 2008      DE          Stuttgart  39800                    NA
24 2009      DE          Stuttgart  36600                    NA
25 2010      DE          Stuttgart  40500                    NA
26 2011      DE          Stuttgart  43000                    NA
27 2012      DE          Stuttgart  43900                    NA
28 2013      DE          Stuttgart  44700                    NA
29 2000      DE          Karlsruhe  29600                    NA
30 2001      DE          Karlsruhe  30600                    NA</code></pre>
<p>It is clear that the data set is on the region-year level. Let us inspect the second data set in the same way. We print the entire data set because it is much smaller.</p>
<div class="sourceCode" id="cb124"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb124-1" title="1">eu2</a></code></pre></div>
<pre><code>   country year population
1       DE 2000  243755442
2       DE 2001  244065601
3       DE 2002  244632480
4       DE 2003  244944119
5       DE 2004  244947919
6       DE 2005  244873939
7       DE 2006  244702713
8       DE 2007  244352058
9       DE 2008  244080027
10      DE 2009  243452378
11      DE 2010  242869525
12      DE 2011  245254806
13      DE 2012  245531229
14      DE 2013  246061734
15      FR 2000  178261418
16      FR 2001  179512459
17      FR 2002  180795834
18      FR 2003  182067770
19      FR 2004  183303083
20      FR 2005  184699398
21      FR 2006  186029101
22      FR 2007  187235541
23      FR 2008  188276925
24      FR 2009  189281644
25      FR 2010  190189326
26      FR 2011  191119409
27      FR 2012  192028925
28      FR 2013  194898565
29      UK 2000  166803394
30      UK 2001  167366218
31      UK 2002  170368601
32      UK 2003  171117914
33      UK 2004  171966941
34      UK 2005  173069726
35      UK 2006  174302125
36      UK 2007  175573637
37      UK 2008  176961583
38      UK 2009  178249105
39      UK 2010  179527970
40      UK 2011  180934071
41      UK 2012  182228946
42      UK 2013  183352914</code></pre>
<p>This data set is on the country-year level. Let’s say we want to merge the second data set to the first data set. The second data set includes the variable <em>population</em> which will be added to the new combinded data set but the observations are one the country-year level. Therefore, all regions in a country-year will get the same population value (which is the population of the entire country). Because the second data set is more aggregated, we cannot get the population on a more dis-aggregated level but we can still combine both data sets. We do so with the <code>merge()</code> function</p>
<div class="sourceCode" id="cb126"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb126-1" title="1">eu3 &lt;-<span class="st"> </span><span class="kw">merge</span>(<span class="dt">x =</span> eu1, <span class="dt">y =</span> eu2, <span class="dt">by =</span> <span class="kw">c</span>(<span class="st">&quot;year&quot;</span>, <span class="st">&quot;country&quot;</span>))</a>
<a class="sourceLine" id="cb126-2" title="2"><span class="kw">dim</span>(eu3)</a></code></pre></div>
<pre><code>[1] 2324    6</code></pre>
<p>So, the new data set has the same amount of observations as the bigger one but if we check the population variable, it is the same value for all regions within a country-year.</p>
</div>
<div id="re-shaping" class="section level3">
<h3><span class="header-section-number">3.1.2</span> Re-shaping</h3>
<p>Re-shaping a data set is useful, for instance for plotting graphs. For example, have a dependent variable, we an independent variable, and we have different model predictions. Let us create some a small data set with 10 observations and two correlated independent variables.</p>
<div class="sourceCode" id="cb128"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb128-1" title="1"><span class="kw">library</span>(MASS)</a></code></pre></div>
<pre><code>
Attaching package: &#39;MASS&#39;</code></pre>
<pre><code>The following object is masked from &#39;package:dplyr&#39;:

    select</code></pre>
<div class="sourceCode" id="cb131"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb131-1" title="1"><span class="kw">set.seed</span>(<span class="dv">123</span>)</a>
<a class="sourceLine" id="cb131-2" title="2"></a>
<a class="sourceLine" id="cb131-3" title="3"><span class="co"># 2 correlated variables</span></a>
<a class="sourceLine" id="cb131-4" title="4">X &lt;-<span class="st"> </span><span class="kw">mvrnorm</span>(<span class="dt">n =</span> <span class="dv">10</span>, <span class="dt">mu =</span> <span class="kw">c</span>(<span class="dv">12</span>, <span class="dv">-4</span>), <span class="dt">Sigma =</span> <span class="kw">matrix</span>(<span class="dt">data =</span> <span class="kw">c</span>(<span class="dv">1</span>, <span class="fl">0.8</span>, <span class="fl">0.8</span>, <span class="dv">1</span>), <span class="dt">nrow =</span> <span class="dv">2</span>, <span class="dt">ncol =</span> <span class="dv">2</span>))</a>
<a class="sourceLine" id="cb131-5" title="5">X &lt;-<span class="st"> </span><span class="kw">data.frame</span>(<span class="dt">x1 =</span> X[,<span class="dv">1</span>], <span class="dt">x2 =</span> X[,<span class="dv">2</span>])</a>
<a class="sourceLine" id="cb131-6" title="6">X</a></code></pre></div>
<pre><code>         x1        x2
1  11.08120 -4.144625
2  11.66785 -4.104582
3  13.35199 -2.394544
4  12.03189 -3.898109
5  12.29843 -4.053119
6  13.06198 -1.807875
7  12.27983 -3.405302
8  11.42176 -5.822041
9  11.12661 -4.429818
10 11.72672 -4.572302</code></pre>
<p>Now that we have the two independent variables, let’s create the outcome variable as a linear function of <em>x2</em> and some random noise.</p>
<div class="sourceCode" id="cb133"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb133-1" title="1">X<span class="op">$</span>y &lt;-<span class="st"> </span><span class="fl">1.7</span> <span class="op">+</span><span class="st"> </span>X<span class="op">$</span>x2 <span class="op">*</span><span class="st"> </span><span class="fl">-2.5</span> <span class="op">+</span><span class="st"> </span><span class="kw">rnorm</span>(<span class="dt">n =</span> <span class="dv">10</span>, <span class="dt">mean =</span> <span class="dv">0</span>, <span class="dt">sd =</span> <span class="dv">3</span>)</a></code></pre></div>
<p>With this done, we run three linear models. The first includes <em>x1</em> only, the second <em>x2</em> only and the third both <em>x1</em> and <em>x2</em>. We then make prediction of y including confidence intervals for all three models and attach them to the data set.</p>
<div class="sourceCode" id="cb134"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb134-1" title="1"><span class="co"># regressions</span></a>
<a class="sourceLine" id="cb134-2" title="2">m1 &lt;-<span class="st"> </span><span class="kw">glm</span>(y <span class="op">~</span><span class="st"> </span>x1, <span class="dt">family =</span> <span class="st">&quot;gaussian&quot;</span>, <span class="dt">data =</span> X)</a>
<a class="sourceLine" id="cb134-3" title="3">m2 &lt;-<span class="st"> </span><span class="kw">glm</span>(y <span class="op">~</span><span class="st"> </span>x2, <span class="dt">family =</span> <span class="st">&quot;gaussian&quot;</span>, <span class="dt">data =</span> X)</a>
<a class="sourceLine" id="cb134-4" title="4">m3 &lt;-<span class="st"> </span><span class="kw">glm</span>(y <span class="op">~</span><span class="st"> </span>x1 <span class="op">+</span><span class="st"> </span>x2, <span class="dt">family =</span> <span class="st">&quot;gaussian&quot;</span>, <span class="dt">data =</span> X)</a>
<a class="sourceLine" id="cb134-5" title="5"></a>
<a class="sourceLine" id="cb134-6" title="6"><span class="co"># predictions</span></a>
<a class="sourceLine" id="cb134-7" title="7">preds1 &lt;-<span class="st"> </span><span class="kw">predict</span>(m1, <span class="dt">se.fit =</span> <span class="ot">TRUE</span>)</a>
<a class="sourceLine" id="cb134-8" title="8">preds2 &lt;-<span class="st"> </span><span class="kw">predict</span>(m2, <span class="dt">se.fit =</span> <span class="ot">TRUE</span>)</a>
<a class="sourceLine" id="cb134-9" title="9">preds3 &lt;-<span class="st"> </span><span class="kw">predict</span>(m3, <span class="dt">se.fit =</span> <span class="ot">TRUE</span>)</a>
<a class="sourceLine" id="cb134-10" title="10"></a>
<a class="sourceLine" id="cb134-11" title="11"><span class="co"># attach point estimates</span></a>
<a class="sourceLine" id="cb134-12" title="12">X<span class="op">$</span>bestguess1 &lt;-<span class="st"> </span>preds1<span class="op">$</span>fit</a>
<a class="sourceLine" id="cb134-13" title="13">X<span class="op">$</span>bestguess2 &lt;-<span class="st"> </span>preds2<span class="op">$</span>fit</a>
<a class="sourceLine" id="cb134-14" title="14">X<span class="op">$</span>bestguess3 &lt;-<span class="st"> </span>preds3<span class="op">$</span>fit</a>
<a class="sourceLine" id="cb134-15" title="15"></a>
<a class="sourceLine" id="cb134-16" title="16"><span class="co"># attach lower and upper bounds of the 95% CI from a t with the appropriate degrees of freedom</span></a>
<a class="sourceLine" id="cb134-17" title="17">X<span class="op">$</span>lowerbound1 &lt;-<span class="st"> </span>preds1<span class="op">$</span>fit <span class="op">-</span><span class="st"> </span><span class="kw">qt</span>(<span class="dt">p =</span> <span class="fl">0.975</span>, <span class="dt">df =</span> m1<span class="op">$</span>df.residual) <span class="op">*</span><span class="st"> </span>preds1<span class="op">$</span>se.fit</a>
<a class="sourceLine" id="cb134-18" title="18">X<span class="op">$</span>lowerbound2 &lt;-<span class="st"> </span>preds2<span class="op">$</span>fit <span class="op">-</span><span class="st"> </span><span class="kw">qt</span>(<span class="dt">p =</span> <span class="fl">0.975</span>, <span class="dt">df =</span> m2<span class="op">$</span>df.residual) <span class="op">*</span><span class="st"> </span>preds2<span class="op">$</span>se.fit</a>
<a class="sourceLine" id="cb134-19" title="19">X<span class="op">$</span>lowerbound3 &lt;-<span class="st"> </span>preds3<span class="op">$</span>fit <span class="op">-</span><span class="st"> </span><span class="kw">qt</span>(<span class="dt">p =</span> <span class="fl">0.975</span>, <span class="dt">df =</span> m3<span class="op">$</span>df.residual) <span class="op">*</span><span class="st"> </span>preds3<span class="op">$</span>se.fit</a>
<a class="sourceLine" id="cb134-20" title="20">X<span class="op">$</span>upperbound1 &lt;-<span class="st"> </span>preds1<span class="op">$</span>fit <span class="op">+</span><span class="st"> </span><span class="kw">qt</span>(<span class="dt">p =</span> <span class="fl">0.975</span>, <span class="dt">df =</span> m1<span class="op">$</span>df.residual) <span class="op">*</span><span class="st"> </span>preds1<span class="op">$</span>se.fit</a>
<a class="sourceLine" id="cb134-21" title="21">X<span class="op">$</span>upperbound2 &lt;-<span class="st"> </span>preds2<span class="op">$</span>fit <span class="op">+</span><span class="st"> </span><span class="kw">qt</span>(<span class="dt">p =</span> <span class="fl">0.975</span>, <span class="dt">df =</span> m2<span class="op">$</span>df.residual) <span class="op">*</span><span class="st"> </span>preds2<span class="op">$</span>se.fit</a>
<a class="sourceLine" id="cb134-22" title="22">X<span class="op">$</span>upperbound3 &lt;-<span class="st"> </span>preds3<span class="op">$</span>fit <span class="op">+</span><span class="st"> </span><span class="kw">qt</span>(<span class="dt">p =</span> <span class="fl">0.975</span>, <span class="dt">df =</span> m3<span class="op">$</span>df.residual) <span class="op">*</span><span class="st"> </span>preds3<span class="op">$</span>se.fit</a>
<a class="sourceLine" id="cb134-23" title="23"></a>
<a class="sourceLine" id="cb134-24" title="24"><span class="co"># print data set</span></a>
<a class="sourceLine" id="cb134-25" title="25">X</a></code></pre></div>
<pre><code>         x1        x2         y bestguess1 bestguess2 bestguess3
1  11.08120 -4.144625  8.858092  13.699237  11.130489   9.641748
2  11.66785 -4.104582 11.307531  11.403226  10.981629  10.589413
3  13.35199 -2.394544  4.608348   4.811964   4.624524   5.644261
4  12.03189 -3.898109  9.258599   9.978477  10.214059  10.304613
5  12.29843 -4.053119  9.957680   8.935323  10.790314  11.567548
6  13.06198 -1.807875  1.159607   5.946962   2.443567   2.261255
7  12.27983 -3.405302 12.726617   9.008104   8.382040   8.418132
8  11.42176 -5.822041 16.715223  12.366378  17.366322  18.364911
9  11.12661 -4.429818  9.360133  13.521520  12.190699  11.100571
10 11.72672 -4.572302 16.892199  11.172839  12.720387  12.951578
   lowerbound1 lowerbound2 lowerbound3 upperbound1 upperbound2 upperbound3
1    8.9231907    9.185198    5.493225    18.47528   13.075781    13.79027
2    8.1521159    9.053073    8.385503    14.65434   12.910186    12.79332
3   -1.4113612    1.427737    1.518502    11.03529    7.821311     9.77002
4    7.0285045    8.331855    8.354573    12.92845   12.096264    12.25465
5    5.7545940    8.879660    8.835127    12.11605   12.700968    14.29997
6    0.7326925   -1.633502   -1.959061    11.16123    6.520636     6.48157
7    5.8550072    6.335486    6.309639    12.16120   10.428593    10.52662
8    8.5825423   13.439212   13.644692    16.15021   21.293433    23.08513
9    8.8894214   10.061580    7.653651    18.15362   14.319817    14.54749
10   8.0152435   10.462938   10.560320    14.33043   14.977835    15.34284</code></pre>
<p>The data set is in the common format for analysis. However, if we want to plot the predictions in ggplot and differentiate them with color by model, we have to re-shape the data set into a long format. In long format, we want to have a new variable called <em>model</em> which takes on the values “model 1”, “model 2”, “model 3” corresponding to the respective model that made the prediction of a best guess, lower or upper bound. We make the data set three times as long by combining <em>bestguess1</em>, <em>bestguess2</em>, and <em>bestguess3</em> into one <em>bestguess</em> variable. We do the same with the upper and lower bounds. The variables <em>x1</em>, <em>x2</em>, and <em>y</em> are so called “id” variables because we just recycle the values that are already there, i.e. nothing is combined here. We use the <code>reshape()</code> function.</p>
<p>Have a look at the argument’s meaning in the help window (usually at lower right in RStudio) by running <code>?reshape</code>.</p>
<div class="sourceCode" id="cb136"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb136-1" title="1">eu.long &lt;-<span class="st"> </span><span class="kw">reshape</span>(<span class="dt">data =</span> X, <span class="dt">varying =</span> <span class="kw">c</span>(<span class="st">&quot;bestguess1&quot;</span>, <span class="st">&quot;lowerbound1&quot;</span>, <span class="st">&quot;upperbound1&quot;</span>,</a>
<a class="sourceLine" id="cb136-2" title="2">                                         <span class="st">&quot;bestguess2&quot;</span>, <span class="st">&quot;lowerbound2&quot;</span>, <span class="st">&quot;upperbound2&quot;</span>,</a>
<a class="sourceLine" id="cb136-3" title="3">                                         <span class="st">&quot;bestguess3&quot;</span>, <span class="st">&quot;lowerbound3&quot;</span>, <span class="st">&quot;upperbound3&quot;</span>),</a>
<a class="sourceLine" id="cb136-4" title="4">                   <span class="dt">timevar =</span> <span class="st">&quot;Model&quot;</span>,</a>
<a class="sourceLine" id="cb136-5" title="5">                   <span class="dt">times =</span> <span class="kw">c</span>(<span class="dv">1</span>,<span class="dv">2</span>,<span class="dv">3</span>),</a>
<a class="sourceLine" id="cb136-6" title="6">                   <span class="dt">v.names =</span> <span class="kw">c</span>(<span class="st">&quot;bestguess&quot;</span>,<span class="st">&quot;lowerbound&quot;</span>,<span class="st">&quot;upperbound&quot;</span>),</a>
<a class="sourceLine" id="cb136-7" title="7">                   <span class="dt">idvar =</span> <span class="kw">c</span>(<span class="st">&quot;x1&quot;</span>,<span class="st">&quot;x2&quot;</span>, <span class="st">&quot;y&quot;</span>),</a>
<a class="sourceLine" id="cb136-8" title="8">                   <span class="dt">direction =</span> <span class="st">&quot;long&quot;</span>)</a>
<a class="sourceLine" id="cb136-9" title="9"></a>
<a class="sourceLine" id="cb136-10" title="10"><span class="co"># change the row.names which are always combinations of the idvars</span></a>
<a class="sourceLine" id="cb136-11" title="11"><span class="kw">row.names</span>(eu.long) &lt;-<span class="st"> </span><span class="kw">seq</span>(<span class="dv">1</span><span class="op">:</span><span class="kw">nrow</span>(eu.long))</a>
<a class="sourceLine" id="cb136-12" title="12"></a>
<a class="sourceLine" id="cb136-13" title="13"><span class="co"># inspect data set</span></a>
<a class="sourceLine" id="cb136-14" title="14">eu.long</a></code></pre></div>
<pre><code>         x1        x2         y Model bestguess lowerbound upperbound
1  11.08120 -4.144625  8.858092     1 13.699237  8.9231907  18.475283
2  11.66785 -4.104582 11.307531     1 11.403226  8.1521159  14.654337
3  13.35199 -2.394544  4.608348     1  4.811964 -1.4113612  11.035289
4  12.03189 -3.898109  9.258599     1  9.978477  7.0285045  12.928450
5  12.29843 -4.053119  9.957680     1  8.935323  5.7545940  12.116053
6  13.06198 -1.807875  1.159607     1  5.946962  0.7326925  11.161232
7  12.27983 -3.405302 12.726617     1  9.008104  5.8550072  12.161200
8  11.42176 -5.822041 16.715223     1 12.366378  8.5825423  16.150213
9  11.12661 -4.429818  9.360133     1 13.521520  8.8894214  18.153618
10 11.72672 -4.572302 16.892199     1 11.172839  8.0152435  14.330434
11 11.08120 -4.144625  8.858092     2 11.130489  9.1851978  13.075781
12 11.66785 -4.104582 11.307531     2 10.981629  9.0530726  12.910186
13 13.35199 -2.394544  4.608348     2  4.624524  1.4277367   7.821311
14 12.03189 -3.898109  9.258599     2 10.214059  8.3318549  12.096264
15 12.29843 -4.053119  9.957680     2 10.790314  8.8796601  12.700968
16 13.06198 -1.807875  1.159607     2  2.443567 -1.6335023   6.520636
17 12.27983 -3.405302 12.726617     2  8.382040  6.3354862  10.428593
18 11.42176 -5.822041 16.715223     2 17.366322 13.4392116  21.293433
19 11.12661 -4.429818  9.360133     2 12.190699 10.0615797  14.319817
20 11.72672 -4.572302 16.892199     2 12.720387 10.4629384  14.977835
21 11.08120 -4.144625  8.858092     3  9.641748  5.4932253  13.790271
22 11.66785 -4.104582 11.307531     3 10.589413  8.3855035  12.793322
23 13.35199 -2.394544  4.608348     3  5.644261  1.5185017   9.770020
24 12.03189 -3.898109  9.258599     3 10.304613  8.3545732  12.254654
25 12.29843 -4.053119  9.957680     3 11.567548  8.8351269  14.299969
26 13.06198 -1.807875  1.159607     3  2.261255 -1.9590606   6.481570
27 12.27983 -3.405302 12.726617     3  8.418132  6.3096388  10.526625
28 11.42176 -5.822041 16.715223     3 18.364911 13.6446922  23.085130
29 11.12661 -4.429818  9.360133     3 11.100571  7.6536509  14.547492
30 11.72672 -4.572302 16.892199     3 12.951578 10.5603200  15.342836</code></pre>
<p>Ee turn the variable model into a factor variable.</p>
<div class="sourceCode" id="cb138"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb138-1" title="1">eu.long<span class="op">$</span>Model &lt;-<span class="st"> </span><span class="kw">factor</span>(eu.long<span class="op">$</span>Model, <span class="dt">levels =</span> <span class="kw">c</span>(<span class="dv">1</span>,<span class="dv">2</span>,<span class="dv">3</span>), <span class="dt">labels =</span> <span class="kw">c</span>(<span class="st">&quot;Incorrect Model&quot;</span>, <span class="st">&quot;Correct Model&quot;</span>, <span class="st">&quot;Full Model&quot;</span>))</a>
<a class="sourceLine" id="cb138-2" title="2"><span class="kw">table</span>(eu.long<span class="op">$</span>Model)</a></code></pre></div>
<pre><code>
Incorrect Model   Correct Model      Full Model 
             10              10              10 </code></pre>
<p>We plot using ggplot.</p>
<div class="sourceCode" id="cb140"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb140-1" title="1"><span class="kw">ggplot</span>(eu.long, <span class="kw">aes</span>(<span class="dt">x =</span> x2, <span class="dt">y =</span> y)) <span class="op">+</span></a>
<a class="sourceLine" id="cb140-2" title="2"><span class="st">  </span><span class="kw">geom_point</span>() <span class="op">+</span></a>
<a class="sourceLine" id="cb140-3" title="3"><span class="st">  </span><span class="kw">geom_line</span>( <span class="kw">aes</span>(<span class="dt">y =</span> bestguess, <span class="dt">color =</span> Model)) <span class="op">+</span></a>
<a class="sourceLine" id="cb140-4" title="4"><span class="st">  </span><span class="kw">geom_ribbon</span>( <span class="kw">aes</span>(<span class="dt">ymin =</span> lowerbound, <span class="dt">ymax =</span> upperbound, <span class="dt">fill =</span> Model), <span class="dt">alpha =</span> <span class="fl">0.3</span>)</a></code></pre></div>
<p><img src="r102_files/figure-html/unnamed-chunk-88-1.png" width="672" /></p>
<p>We see that the all model predictions overlap. The incorrect model does worst and also has the largest amount of uncertainty. While it is hard to see, the correct model is closest to the real predictions and has the smallest uncertainty. Go ahead and plot the size of the residuals on your own.</p>
</div>
<div id="regular-expression" class="section level3">
<h3><span class="header-section-number">3.1.3</span> Regular expression</h3>
<p>Regular expressions are difficult to master but very powerful when it comes to working with data. Regular expressions can be used to extract email addresses, phone numbers, country names and much more. We provide a simple example and invite you to search online for more complex tasks.</p>
<p>We examine the <code>eu</code> data set and the regions in the UK.</p>
<div class="sourceCode" id="cb141"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb141-1" title="1"><span class="kw">unique</span>(eu1<span class="op">$</span>region[eu1<span class="op">$</span>country<span class="op">==</span><span class="st">&quot;UK&quot;</span>])</a></code></pre></div>
<pre><code> [1] &quot;NORTH EAST (ENGLAND)&quot;                            
 [2] &quot;Tees Valley and Durham&quot;                          
 [3] &quot;Northumberland and Tyne and Wear&quot;                
 [4] &quot;NORTH WEST (ENGLAND)&quot;                            
 [5] &quot;Cumbria&quot;                                         
 [6] &quot;Cheshire&quot;                                        
 [7] &quot;Greater Manchester&quot;                              
 [8] &quot;Lancashire&quot;                                      
 [9] &quot;Merseyside&quot;                                      
[10] &quot;YORKSHIRE AND THE HUMBER&quot;                        
[11] &quot;East Yorkshire and Northern Lincolnshire&quot;        
[12] &quot;North Yorkshire&quot;                                 
[13] &quot;South Yorkshire&quot;                                 
[14] &quot;West Yorkshire&quot;                                  
[15] &quot;EAST MIDLANDS (ENGLAND)&quot;                         
[16] &quot;Derbyshire and Nottinghamshire&quot;                  
[17] &quot;Leicestershire, Rutland and Northamptonshire&quot;    
[18] &quot;Lincolnshire&quot;                                    
[19] &quot;WEST MIDLANDS (ENGLAND)&quot;                         
[20] &quot;Herefordshire, Worcestershire and Warwickshire&quot;  
[21] &quot;Shropshire and Staffordshire&quot;                    
[22] &quot;West Midlands&quot;                                   
[23] &quot;EAST OF ENGLAND&quot;                                 
[24] &quot;East Anglia&quot;                                     
[25] &quot;Bedfordshire and Hertfordshire&quot;                  
[26] &quot;Essex&quot;                                           
[27] &quot;LONDON&quot;                                          
[28] &quot;Inner London&quot;                                    
[29] &quot;Outer London&quot;                                    
[30] &quot;Inner London - West&quot;                             
[31] &quot;Inner London - East&quot;                             
[32] &quot;Outer London - East and North East&quot;              
[33] &quot;Outer London - South&quot;                            
[34] &quot;Outer London - West and North West&quot;              
[35] &quot;SOUTH EAST (ENGLAND)&quot;                            
[36] &quot;Berkshire, Buckinghamshire and Oxfordshire&quot;      
[37] &quot;Surrey, East and West Sussex&quot;                    
[38] &quot;Hampshire and Isle of Wight&quot;                     
[39] &quot;Kent&quot;                                            
[40] &quot;SOUTH WEST (ENGLAND)&quot;                            
[41] &quot;Gloucestershire, Wiltshire and Bristol/Bath area&quot;
[42] &quot;Dorset and Somerset&quot;                             
[43] &quot;Cornwall and Isles of Scilly&quot;                    
[44] &quot;Devon&quot;                                           
[45] &quot;WALES&quot;                                           
[46] &quot;West Wales and The Valleys&quot;                      
[47] &quot;East Wales&quot;                                      
[48] &quot;SCOTLAND&quot;                                        
[49] &quot;North Eastern Scotland&quot;                          
[50] &quot;Eastern Scotland&quot;                                
[51] &quot;South Western Scotland&quot;                          
[52] &quot;Highlands and Islands&quot;                           
[53] &quot;NORTHERN IRELAND&quot;                                
[54] &quot;Northern Ireland&quot;                                
[55] &quot;EXTRA-REGIO NUTS 1&quot;                              
[56] &quot;Extra-Regio NUTS 2&quot;                              </code></pre>
<p>There are multiple regions of London in the data set. Say we wanted to aggregate wealth for all the London regions but we did not want to pick out the regions by hand. This is what regular expressions excel at. We use the <code>grep()</code> function which returns the row numbers of all London districts. Let’s subset the data set to London only and then compare the wealth of London regions over time in a plot.</p>
<div class="sourceCode" id="cb143"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb143-1" title="1"><span class="kw">grep</span>(<span class="dt">pattern =</span> <span class="st">&quot;London&quot;</span>, <span class="dt">x =</span> eu1<span class="op">$</span>region, <span class="dt">ignore.case =</span> <span class="ot">TRUE</span>)</a></code></pre></div>
<pre><code>  [1] 1877 1878 1879 1880 1881 1882 1883 1884 1885 1886 1887 1888 1889 1890
 [15] 1891 1892 1893 1894 1895 1896 1897 1898 1899 1900 1901 1902 1903 1904
 [29] 1905 1906 1907 1908 1909 1910 1911 1912 1913 1914 1915 1916 1917 1918
 [43] 1919 1920 1921 1922 1923 1924 1925 1926 1927 1928 1929 1930 1931 1932
 [57] 1933 1934 1935 1936 1937 1938 1939 1940 1941 1942 1943 1944 1945 1946
 [71] 1947 1948 1949 1950 1951 1952 1953 1954 1955 1956 1957 1958 1959 1960
 [85] 1961 1962 1963 1964 1965 1966 1967 1968 1969 1970 1971 1972 1973 1974
 [99] 1975 1976 1977 1978 1979 1980 1981 1982 1983 1984 1985 1986 1987 1988</code></pre>
<div class="sourceCode" id="cb145"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb145-1" title="1">london &lt;-<span class="st"> </span>eu1 <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb145-2" title="2"><span class="st">  </span><span class="kw">slice</span>( <span class="kw">grep</span>(<span class="dt">pattern =</span> <span class="st">&quot;London&quot;</span>, <span class="dt">x =</span> eu1<span class="op">$</span>region, <span class="dt">ignore.case =</span> <span class="ot">TRUE</span>) ) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb145-3" title="3"><span class="st">  </span><span class="kw">filter</span>( region <span class="op">!=</span><span class="st"> &quot;LONDON&quot;</span> )</a>
<a class="sourceLine" id="cb145-4" title="4"></a>
<a class="sourceLine" id="cb145-5" title="5"><span class="kw">ggplot</span>(london, <span class="kw">aes</span>(<span class="dt">x =</span> year, <span class="dt">y =</span> wealth)) <span class="op">+</span></a>
<a class="sourceLine" id="cb145-6" title="6"><span class="st">       </span><span class="kw">geom_line</span>( <span class="kw">aes</span>(<span class="dt">y =</span> wealth, <span class="dt">color =</span> region)) </a></code></pre></div>
<pre><code>Warning: Removed 28 rows containing missing values (geom_path).</code></pre>
<p><img src="r102_files/figure-html/unnamed-chunk-91-1.png" width="672" /></p>
<p>It seems like Inner London - West is the place to be.</p>

</div>
</div>
</div>
            </section>

          </div>
        </div>
      </div>
<a href="seminar2.html" class="navigation navigation-prev navigation-unique" aria-label="Previous page"><i class="fa fa-angle-left"></i></a>

    </div>
  </div>
<script src="libs/gitbook-2.6.7/js/app.min.js"></script>
<script src="libs/gitbook-2.6.7/js/lunr.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-search.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-sharing.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-fontsettings.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-bookdown.js"></script>
<script src="libs/gitbook-2.6.7/js/jquery.highlight.js"></script>
<script>
gitbook.require(["gitbook"], function(gitbook) {
gitbook.start({
"sharing": {
"github": false,
"facebook": false,
"twitter": false,
"google": false,
"linkedin": false,
"weibo": false,
"instapaper": false,
"vk": false,
"all": {}
},
"fontsettings": {
"theme": "white",
"family": "sans",
"size": 2
},
"edit": {
"link": null,
"text": null
},
"history": {
"link": null,
"text": null
},
"download": ["r102.pdf"],
"toc": {
"collapse": "section",
"scroll_highlight": true
}
});
});
</script>

<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    var src = "true";
    if (src === "" || src === "true") src = "https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-MML-AM_CHTML";
    if (location.protocol !== "file:")
      if (/^https?:/.test(src))
        src = src.replace(/^https?:/, '');
    script.src = src;
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>
</body>

</html>
